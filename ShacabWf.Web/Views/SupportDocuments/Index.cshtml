@model IEnumerable<ShacabWf.Web.Models.SupportDocument>

@{
    ViewData["Title"] = "Support Documents";
}

<div class="container-fluid">
    <h1 class="mt-4">Support Documents</h1>
    <p>
        @if (User.Identity.IsAuthenticated)
        {
            var user = ViewBag.CurrentUser;
            if (user != null && (user.HasRole("Admin") || user.IsCABMember || user.IsSupportPersonnel))
            {
                <a asp-action="Create" class="btn btn-primary">Upload New Document</a>
            }
        }
    </p>

    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-file-alt me-1"></i>
            Available Documents
        </div>
        <div class="card-body">
            <table id="documentsTable" class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>File Name</th>
                        <th>Description</th>
                        <th>Size</th>
                        <th>Uploaded By</th>
                        <th>Upload Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.FileName</td>
                            <td>@item.Description</td>
                            <td>@(item.FileSize < 1024 * 1024 ? $"{item.FileSize / 1024} KB" : $"{item.FileSize / (1024 * 1024):F2} MB")</td>
                            <td>@item.UploadedBy.FullName</td>
                            <td>@item.UploadedAt.ToString("MMM dd, yyyy HH:mm")</td>
                            <td>
                                <a asp-action="Download" asp-route-id="@item.Id" class="btn btn-sm btn-info">
                                    <i class="fas fa-download"></i> Download
                                </a>
                                @if (User.Identity.IsAuthenticated)
                                {
                                    var user = ViewBag.CurrentUser;
                                    if (user != null && user.HasRole("Admin"))
                                    {
                                        <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-danger">
                                            <i class="fas fa-trash"></i> Delete
                                        </a>
                                    }
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#documentsTable').DataTable({
                order: [[4, 'desc']] // Sort by upload date (column 4) in descending order
            });
        });
    </script>
} 